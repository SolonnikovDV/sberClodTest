### Task 5

```sql
create table tt 
(
    id1, -- ссылка на таблицу t1
    id2, -- ссылка на таблицу t2
    id3, -- ссылка на таблицу t3
    s1,
    s2,
    f1,
    f2,
    unique (id1, id2, id3)
);
```

где ```id1, id2, id3``` - внешние ключи

#### Необходимо представить эту таблицу в виде:
* якорной модели (anchor modeling) 
* дата волта (data vault)

#### Подготовка:
* Учитывая, что модели Data Vault и  Anchor предполагают пределенную глубину нормализации, 
то перед представлением моделей подвергнем таблицу декомпозиции


### Data vault
#### Описание моделирования
* Допустим: 
  * таблицы t1, t2, t3 являются бизнес-сущностями (hub). Поля данных сущностей не меняются.
  таблицы сущностей имеют ключ, дающий доступ к иным системам и внутрений инкрементальный ключ для индексации данных
  * таблицы f1 и f2 - связи (link) между сущностями, содержат в себе в качестве внешних ключей ключи (id1, id2, id3) сущностей
product customer store
    * таблицы s1 и s2 - сателиты (satellite) содержит свойства бизнес-сущности (ее изменяемые атрибуты) или связи
* Создадим таблицы, где:
  * t1, t2, t3 являются бизнес-сущностями Producer, Product, Customer (hub_t1_customer, hub_t2_product, hub_t3_manufacturer)
  * f1 и f2 являются материализацией взаимодействия между бизнес-сущностями (бизнес-процесс) такими как Produces и Buys (как процесс демонстрации товара)
  * s1 и s2 описывают атрибуты и(или) свойства бизнес сущности или процесса (связи), в данном случае описываются атрибуты бизнес-сущностей SocialId (соцальный идентификатор), ProdSpec (спецификация товара)
  * Связи и аттрибуты связываются с бизнес-сущностями внешними ключами (id)
  * Buys cвязывает Produces и Customer, Produces связывает Producer и Product, т е выполняем ссылку линка на линк
  * SocialId описывает бизнес-сущность Customer, ProdSpec описывает Product

#### Create hub tables
```sql
CREATE TABLE hub_t1_customer (
    t1_pk BIGINT NOT NULL AUTO_INCREMENT,
    t1_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    UNIQUE (t1_id),
    PRIMARY KEY (t1_pk)
);

CREATE TABLE hub_t2_product (
    t2_pk BIGINT NOT NULL AUTO_INCREMENT,
    t2_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    UNIQUE (t2_id),
    PRIMARY KEY (t2_pk)
);

CREATE TABLE hub_t3_producer (
    t3_pk BIGINT NOT NULL AUTO_INCREMENT,
    t3_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    UNIQUE (t3_id),
    PRIMARY KEY (t3_pk)
);
```
#### Create link tables:

```sql
-- interaction between producer and product
CREATE TABLE l_f1_produces (
    f1_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    t3_id VARCHAR(36) NOT NULL, -- fk to producer hub
    t2_id VARCHAR(36) NOT NULL -- fk to product hub
);
-- interaction between customer and produces
CREATE TABLE l_f2_buys (
    f2_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    t1_id VARCHAR(36) NOT NULL, -- fk to customer hub
    f1_id VARCHAR(36) NOT NULL -- fk to produces link
);
```
#### Create satellite tables:

```sql
-- customer attribute
CREATE TABLE S_s1_socialId (
    t1_id VARCHAR(36) NOT NULL, -- fk to customer hub
    -- attributes
    f_name varchar(20) NOT NULL,
    l_name varchar(20) NOT NULL,
    soc_id bigint NOT NULL,
    from_date timestamp,
    to_date timestamp
);
-- product attribute
CREATE TABLE S_s2_prodSpec (
    t2_id VARCHAR(36) NOT NULL, -- fk to product key
    -- attributes
    brand varchar(20) NOT NULL,
    dimensions JSON NOT NULL,
    inUse boolean,
    from_date timestamp,
    to_date timestamp
);
```

#### [Общий вид модели Anchor/DataVault](task_5/DataVault_model.png)

### Anchor Model
* Разница между моделингом DataVault и Anchor:
  * Anchor не допускает ссылок линков на линки
  * Anchor не допускает наличие саттелитов на линках
#### Описание моделирования
* За основу возьмем описание Data Vault за исключением связей линков:
  * Buys cвязывает Product и Customer, Produces связывает Producer и Product, в данном случае снимаем ссылку на линк и меняем ее ссылкой на хаб
  * SocialId описывает бизнес-сущность Customer, ProdSpec описывает Product


#### Create link tables:

```sql
-- interaction between producer and product
CREATE TABLE l_f1_produces (
    f1_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    t3_id VARCHAR(36) NOT NULL, -- fk to producer hub
    t2_id VARCHAR(36) NOT NULL -- fk to product hub
);
-- interaction between customer and product
CREATE TABLE l_f2_buys (
    f2_id VARCHAR(36) NOT NULL, -- autogenerated hash string
    t2_id VARCHAR(36) NOT NULL, -- fk to product hub
    t1_id VARCHAR(36) NOT NULL -- fk to customer hub
);
```

#### [Общий вид модели Anchor/DataVault](task_5/DataVault_Anchor_model.png)